package logid

import (
	"net"
	"time"
)

var defaultGen *v1Gen

func init() {
	defaultGen = &v1Gen{}
}

// Gen generates a new log ID string using the default generator.
func Gen() string {
	return defaultGen.Gen()
}

// minLength is the minimum length of a log ID generated by this package.
// Update this when adding new generators.
const minLength = 47

const strTimeMilli = "20060102150405.000Z0700"

func Decode(s string) (info Info) {
	if len(s) >= minLength {
		switch s[0] {
		case v1Version:
			return Info{decodeV1(s)}
		}
	}
	return // invalid
}

type Info struct {
	infoInterface
}

func (i Info) Valid() bool {
	return i.infoInterface != nil && i.infoInterface.Valid()
}

func (i Info) String() string {
	if i.infoInterface == nil {
		return "0|invalid"
	}
	return i.infoInterface.String()
}

type infoInterface interface {
	Valid() bool
	Version() string
	Time() time.Time
	IP() net.IP
	Random() int
	String() string
}
